<html>
    <head>
        <title>Pong</title>
    </head>
    <body>
        <canvas id="cv" width="400" height="400">

        </canvas>
        <script type="text/javascript">

            window.$ = window.jQuery = require('./bower_components/jquery/dist/jquery.min.js');
            console.log(window.$);
            var ctx = document.getElementById('cv').getContext('2d');

            window.requestAnimationFrame(draw);

            var ballPosition = {x: 100, y:100};
            var players = [];

            // establish the communication channel over a websocket
            var ws = new WebSocket("ws://localhost:8000/games");
             
            // called when socket connection established
            ws.onopen = function() {
                console.log("Websocket open!");
            };
             
            // called when a message received from server
            ws.onmessage = function (evt) {
                var data = JSON.parse(evt.data);
                console.log("Got: ", data);
                ballPosition = data.ball;
                players = data.players;
            };
             
            // called when socket connection closed
            ws.onclose = function() {
                console.log("Disconnected from web socket!");
            };
             
            // called in case of an error
            ws.onerror = function(err) {
                console.log("ERROR!", err )
            };

            function draw() {
                ctx.clearRect(0,0,400,400);
                ctx.setTransform(1, 0, 0, 1, 0, 0);
                ctx.fillStyle = 'rgb(0,0,255)';
                ctx.strokeStyle = 'rgb(0,0,255)';

                // console.log("tick");
                // $.get('http://localhost:8000/games', {}, function(data) {
                //     // console.log("Got data",$($.parseXML(data)).find('count').first());
                //     console.log("response");
                //     if (data) {
                //         ballPosition = data.games[0].ball;
                //     }
                // }, 'json');

                ctx.fillRect(ballPosition.x-10+200,ballPosition.y-10+200,20,20);

                for (var i = 0; i < players.length; i++) {
                    var player = players[i];
                    ctx.fillRect(player.x, player.y - 50, 30, 100);
                }

                window.requestAnimationFrame(draw);
            }

        </script>
    </body>
</html>
